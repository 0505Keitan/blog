---
layout: post
title: 自宅Raspberry Piに外出先からポート開放せずSFTPでファイルにアクセスする方法
date: 2019-04-17 00:00
permalink: raspi-access
tags: Qiitaからの移植
---
# はじめに
わたくしの家は色々特殊でポート開放ができず、外からRaspberryPiにアクセスすることが不可能でした。そのRaspberryPiではDiscordBOTをホストしていて、万が一BOTが落ちた時には帰宅してからの対応しかできませんでした。しかし、とある方法を利用することで外からでのアクセスもできるようになるのでご紹介します。この記事ではMacでのやり方を説明しています。

# 使うもの
- RaspberryPi
- ネットワーク環境
- Dataplicity

# 設定開始
とりあえず[Dataplicity](https://www.dataplicity.com/)にアクセスして、指示に従えばできる。

(ここから先はDataplicityの方法をそのまま書いてありますので別に読まなくても大丈夫です。)
まずはサイトを開いて①をやる。①はメールアドレスを入れるだけ。そうしたら確認メールが届くので認証する。

②はラズパイにSSHとかでアクセスしてコンソールから以下のコマンドを入力します。

```sh
$ curl https://www.dataplicity.com/hoex5qsx.py | sudo python
```

# SSHの準備

今回はSFTPでSSHを利用します。
わたくしはラズパイのSSH接続設定はもともとしていたのでこのまま進みます。してない人は接続設定をしておきましょう。

次に接続用のアプリケーションをインストールします。接続用アプリケーションは[Porthole](https://github.com/wildfoundry/dataplicity-porthole-releases-osx)というアプリです。

アプリをインストールしたら起動し、真ん中の**Add new**をクリックし、設定します。
次の画面では①②③と表示が出ていると思いますが、まずは①にMacで使うローカルのポートを指定します。このポートは被ってなければどこのポートでも大丈夫です👌

続いて②でRaspberryPiの選択をし、③でアクセスしたいポート(5901 or 22)を選択します。今回はSSHを利用するので22を選択します。

*もしSSHなどのポートを変更している場合は別途課金が必要なようです。

# 接続
FTPマネージャーなどで以下のように設定します。

| 設定名 | 入力するやつ |
|:------|:------|
| ファイルプロトコル | SFTP |
| アドレス | localhost |
| ポート | Portholeで設定した①のポート |
| ユーザー名 | ラズパイのユーザー名 |
| パスワード | ユーザーのパスワード |

設定できたらPortholeアプリケーションを起動しておきます。そしてFTPアプリケーションでアクセスすれば完了です！お疲れ様でした。

